<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>랜덤 퀴즈</title>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; text-align: center; }
  #quizBox { font-size: 22px; margin-bottom: 20px; white-space: pre-line; }
  button { padding: 12px 20px; font-size: 18px; margin: 10px; cursor: pointer; }
  #answerBox { margin-top: 20px; font-size: 20px; color: #444; white-space: pre-line; }
</style>
</head>
<body>

<h1>랜덤 퀴즈</h1>
<div id="quizBox">문제를 불러오는 중...</div>
<button id="showAnswerBtn">정답 보기</button>
<button id="nextBtn">다음 문제</button>

<div id="answerBox"></div>

<script>
// ⭐ 네 구글 시트 CSV URL
const CSV_URL = "https://docs.google.com/spreadsheets/d/16VxOkZhO-TgUWYdQ0BGyGhBR5MKUvyb9Mo6lv4UVx0Q/export?format=csv";

// CSV 파싱 (줄바꿈 자동 정리)
function parseCSV(text) {
    // 먼저 전체 줄바꿈을 하나의 줄로 합쳐서 레코드 단위로 분리
    const normalized = text.replace(/\r/g, "");
    const lines = normalized.split(/\n(?=(?![^"]*"(?:(?:[^"]*"){2})*[^"]*$))/);

    // 첫 줄은 헤더이므로 제거
    const header = lines.shift();

    return lines
      .map(line => {
        // 큰따옴표 제거
        const clean = line.replace(/^"|"$/g, "").replace(/""/g, '"');

        // 쉼표 기준(split)으로 3칸 보장
        const parts = clean.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);

        return {
          question: (parts[0] || "").trim(),
          answer: (parts[1] || "").trim(),
          note: (parts[2] || "").trim()
        };
      })
      .filter(q => q.question !== "");
}

let quizData = [];
let current = null;

function pickRandom() {
    current = quizData[Math.floor(Math.random() * quizData.length)];
    document.getElementById("quizBox").textContent = current.question;
    document.getElementById("answerBox").textContent = "";
}

document.getElementById("showAnswerBtn").onclick = () => {
    document.getElementById("answerBox").textContent =
        `정답: ${current.answer}\n\n비고: ${current.note}`;
};

document.getElementById("nextBtn").onclick = pickRandom;

fetch(CSV_URL)
  .then(res => res.text())
  .then(text => {
      quizData = parseCSV(text);
      pickRandom();
  })
  .catch(err => {
      document.getElementById("quizBox").textContent = "CSV 로딩 실패 :(";
      console.error(err);
  });

</script>

</body>
</html>
