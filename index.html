<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>랜덤 퀴즈</title>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; text-align: center; }
  #quizBox { font-size: 22px; margin-bottom: 20px; white-space: pre-wrap; }
  button { padding: 12px 20px; font-size: 18px; margin: 10px; cursor: pointer; }
  #answerBox { margin-top: 20px; font-size: 20px; color: #444; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>랜덤 퀴즈</h1>
<div id="quizBox">문제를 불러오는 중...</div>
<button id="showAnswerBtn">정답 보기</button>
<button id="nextBtn">다음 문제</button>

<div id="answerBox"></div>

<script>
// ⭐ 네 구글 시트 CSV URL
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/16VxOkZhO-TgUWYdQ0BGyGhBR5MKUvyb9Mo6lv4UVx0Q/export?format=csv";

// 고급 CSV 파서 (줄바꿈 포함 레코드 처리)
function smartParseCSV(text) {
    text = text.replace(/\r/g, "");

    const rows = [];
    let current = [];
    let insideQuotes = false;
    let value = "";

    for (let i = 0; i < text.length; i++) {
        const c = text[i];
        const next = text[i + 1];

        if (c === '"' && next === '"') {
            value += '"';
            i++;
        } else if (c === '"') {
            insideQuotes = !insideQuotes;
        } else if (c === ',' && !insideQuotes) {
            current.push(value);
            value = "";
        } else if (c === '\n' && !insideQuotes) {
            current.push(value);
            rows.push(current);
            current = [];
            value = "";
        } else {
            value += c;
        }
    }

    if (value || current.length) {
        current.push(value);
        rows.push(current);
    }

    return rows;
}

let quizData = [];
let current = null;

function pickRandom() {
    current = quizData[Math.floor(Math.random() * quizData.length)];
    document.getElementById("quizBox").textContent = current.question;
    document.getElementById("answerBox").textContent = "";
}

document.getElementById("showAnswerBtn").onclick = () => {
    document.getElementById("answerBox").textContent =
        `정답: ${current.answer}\n\n비고: ${current.note}`;
};

document.getElementById("nextBtn").onclick = pickRandom;

fetch(CSV_URL)
  .then(res => res.text())
  .then(text => {
      const rows = smartParseCSV(text);
      rows.shift(); // Header 제거

      quizData = rows
        .filter(r => r[0] && r[0].trim() !== "")
        .map(r => ({
            question: r[0],
            answer: r[1] || "",
            note: r[2] || ""
        }));

      pickRandom();
  })
  .catch(err => {
      document.getElementById("quizBox").textContent = "CSV 로딩 실패!";
      console.error(err);
  });

</script>

</body>
</html>
